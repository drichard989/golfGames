<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <title>Manito Golf Games</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
    <meta name="description" content="Interactive golf scorecard with Vegas & Banker side games" />
    <!-- Aggressive cache prevention for iOS -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#4a9eff" />
    <style>
      /* =========================
   Manito Golf Games ‚Äî Refactored CSS
   ========================= */
      /* ---- Theme tokens (dark default) ---- */
      :root {
        --bg: #0b0d10;
        --panel: #11151a;
        --ink: #e8eef5;
        --muted: #a8b3bf;
        --accent: #68d391;
        --line: #1e242b;
        --warn: #ffb454;
        --danger: #ff6b6b;
        --shadow: rgba(0, 0, 0, .35);
      }

      /* ---- Base / resets ---- */
      * {
        box-sizing: border-box
      }

      html,
      body {
        height: 100%
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: linear-gradient(180deg, #0a0c10 0%, #0c1117 100%);
        background-color: var(--bg);
        /* fallback, prevents white flash */
        color: var(--ink);
        color-scheme: dark;
        overscroll-behavior: none;
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        -webkit-tap-highlight-color: transparent;
        /* Remove tap highlight on iOS */
      }

      /* iOS/WebKit ensure dark behind safe-area */
      @supports (-webkit-touch-callout: none) {

        html,
        body {
          background-color: var(--bg)
        }
      }

      /* ---- Header / controls ---- */
      header {
        padding: 20px 16px 12px;
        display: grid;
        gap: 12px
      }

      h1 {
        margin: 0;
        font-size: clamp(18px, 3.5vw, 28px);
        letter-spacing: .2px
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center
      }

      .control {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 10px;
        padding: 8px 12px;
        display: flex;
        gap: 8px;
        align-items: center;
        min-height: 44px;
        /* iOS touch target minimum */
      }

      .control label {
        font-size: 13px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: .08em
      }

      .control input[type="text"] {
        background: #0c1218;
        border: 1px solid var(--line);
        color: var(--ink);
        border-radius: 8px;
        padding: 10px 12px;
        min-width: 120px;
        min-height: 44px;
        font-size: 16px;
        /* Prevents iOS zoom on focus */
      }

      .btn {
        border: 1px solid var(--line);
        background: var(--panel);
        color: var(--ink);
        padding: 12px 16px;
        border-radius: 10px;
        cursor: pointer;
        min-height: 44px;
        font-size: 15px;
        display: inline-flex;
        align-items: center;
        justify-content: center
      }

      .btn:hover {
        filter: brightness(1.1)
      }

      .btn.accent {
        border-color: #224;
        background: #14202a
      }

      .meta {
        font-size: 12px;
        color: var(--muted)
      }

      /* ---- Theme toggle button ---- */
      .theme-toggle {
        background: var(--panel);
        color: var(--ink);
        border: 1px solid var(--line);
        border-radius: 10px;
        padding: 12px 16px;
        font-size: 15px;
        cursor: pointer;
        transition: background .25s, color .25s, border-color .25s;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center
      }

      .theme-toggle:hover {
        filter: brightness(1.08)
      }

      /* ---- Utilities Section ---- */
      .utilities-section {
        display: none;
        margin-top: 12px;
      }

      .utilities-section.open {
        display: block;
      }

      /* =========================
   Scorecard (scrollable)
   ========================= */
      .wrap {
        padding: 12px 0 24px;
        overflow-x: auto;
        overflow-y: visible !important;
        /* allow page to scroll vertically on mobile */
        -webkit-overflow-scrolling: touch;
        touch-action: pan-x pan-y;
        /* Allow horizontal and vertical scrolling */
        overscroll-behavior-x: contain;
        position: relative;
        background: var(--panel);
        /* Better momentum scrolling on iOS */
        scroll-behavior: smooth;
      }

      .wrap::before,
      .wrap::after {
        content: "";
        position: sticky;
        top: 0;
        width: 18px;
        height: 100%;
        pointer-events: none;
        z-index: 6
      }

      .wrap::before {
        left: 0;
        box-shadow: inset 12px 0 12px -12px var(--shadow)
      }

      .wrap::after {
        right: 0;
        box-shadow: inset -12px 0 12px -12px var(--shadow)
      }

      table {
        width: 100%;
        min-width: 860px;
        /* Horizontal scroll enabled for full scorecard view */
        border-collapse: separate;
        border-spacing: 0;
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 14px;
        overflow: hidden
      }

      thead th {
        position: sticky;
        top: 0;
        background: #0f151b;
        z-index: 3
      }

      th,
      td {
        border-bottom: 1px solid var(--line);
        text-align: center;
        font-variant-numeric: tabular-nums;
        vertical-align: middle;
        padding: 6px 5px;
        white-space: nowrap
      }

      th:first-child,
      td:first-child {
        text-align: left;
        padding-left: 10px;
        min-width: 150px;
        position: sticky;
        left: 0;
        background-color: var(--panel);
        z-index: 4;
        border-right: 1px solid var(--line);
        /* iOS sticky fix */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      thead th:first-child {
        z-index: 5
      }

      tr:last-child td {
        border-bottom: none
      }

      /* Divider between front 9 and back 9 (after hole 9, before hole 10) */
      th:nth-child(12),
      td:nth-child(12) {
        border-left: 3px solid rgba(168, 179, 191, 0.4) !important;
      }

      .subtle {
        color: var(--muted);
        font-size: 12px
      }

      /* Emphasize Par and Handicap rows (dark mode default) */
      .par-row th,
      .par-row td {
        background: transparent;
        border-left: 1px solid rgba(255, 255, 255, 0.15);
        border-right: none;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
        border-bottom: none;
      }

      .hcp-row th,
      .hcp-row td {
        background: transparent;
        border-left: 1px solid rgba(255, 255, 255, 0.15);
        border-right: none;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

      .par-row input,
      .hcp-row input {
        width: 48px;
        text-align: center;
        border-radius: 0;
        border: none;
        background: transparent;
        color: var(--ink);
        padding: 10px 6px;
        -moz-appearance: textfield;
        appearance: textfield;
        min-height: 44px;
        font-size: 16px;
        pointer-events: none;
        touch-action: manipulation;
      }

      .score-input,
      .ch-input {
        width: 48px;
        text-align: center;
        border-radius: 8px;
        border: 1px solid var(--line);
        background: #0c1218;
        color: var(--ink);
        padding: 10px 6px;
        -moz-appearance: textfield;
        appearance: textfield;
        min-height: 44px;
        font-size: 16px;
        /* Prevents iOS zoom on focus */
        touch-action: manipulation;
        /* Better mobile tap response */
      }

      /* Divider after hole 18 */
      .hole-18 {
        border-right: 2px solid rgba(255, 255, 255, 0.4) !important;
      }

      .par-row input::-webkit-outer-spin-button,
      .par-row input::-webkit-inner-spin-button,
      .hcp-row input::-webkit-outer-spin-button,
      .hcp-row input::-webkit-inner-spin-button,
      .score-input::-webkit-outer-spin-button,
      .score-input::-webkit-inner-spin-button,
      .ch-input::-webkit-outer-spin-button,
      .ch-input::-webkit-inner-spin-button,
      #skinsBuyIn::-webkit-outer-spin-button,
      #skinsBuyIn::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0
      }

      .ch-input {
        width: 60px
      }

      .score-input.invalid {
        border-color: var(--danger)
      }

      .score-input.receives-stroke {
        border: 2px solid var(--accent);
        box-shadow: 0 0 0 1px var(--accent);
      }
      
      /* Multiple strokes - add extra rings with visible separation */
      .score-input.receives-stroke[data-strokes="2"] {
        border: 2px solid var(--accent);
        box-shadow: 0 0 0 6px var(--bg), 0 0 0 8px var(--accent);
      }
      
      .score-input.receives-stroke[data-strokes="3"] {
        border: 2px solid var(--accent);
        box-shadow: 0 0 0 6px var(--bg), 0 0 0 8px var(--accent), 0 0 0 12px var(--bg), 0 0 0 14px var(--accent);
      }

      .total,
      .to-par,
      .split,
      .net {
        font-weight: 600
      }

      .to-par[data-sign="+"] {
        color: var(--danger)
      }

      .to-par[data-sign="-"] {
        color: var(--accent)
      }

      .to-par[data-sign="0"] {
        color: var(--warn)
      }

      tfoot td {
        background: #0f151b;
        font-weight: 600
      }

      .note {
        margin: 8px 12px 14px;
        color: var(--muted);
        font-size: 12px
      }

      .small {
        font-size: 11px;
        color: var(--muted);
        margin: 0 12px
      }

      .name-edit {
        background: transparent;
        border: none;
        color: var(--ink);
        font-weight: 600;
        font-size: 14px;
        width: 100%;
        padding: 6px 10px;
        display: block
      }

      .name-edit:focus {
        outline: 1px dashed var(--accent);
        border-radius: 6px
      }

      /* ---- Scorecard responsive tweaks ---- */
      @media (max-width:1400px) {

        th,
        td {
          padding: 8px 5px;
        }

        .par-row input,
        .hcp-row input,
        .score-input {
          width: 46px;
          padding: 10px 4px;
          min-height: 44px;
        }

        .ch-input {
          width: 58px;
        }

        th:first-child,
        td:first-child {
          min-width: 150px;
        }

        table {
          min-width: 840px;
        }
      }

      @media (max-width:1200px) {

        th,
        td {
          padding: 8px 4px;
        }

        .par-row input,
        .hcp-row input,
        .score-input {
          width: 44px;
          padding: 10px 3px;
          min-height: 44px;
        }

        .ch-input {
          width: 56px;
        }

        th:first-child,
        td:first-child {
          min-width: 140px;
        }

        table {
          min-width: 820px;
        }
      }
      @media (max-width:900px) {

        th,
        td {
          padding: 8px 5px
        }

        .name-edit {
          font-size: 16px;
          /* Prevent iOS zoom */
          padding: 10px 12px;
          min-height: 44px
        }

        th:first-child,
        td:first-child {
          min-width: 160px
        }

        .par-row input,
        .hcp-row input,
        .score-input {
          width: 48px;
          padding: 10px 4px;
          min-height: 44px
        }

        .ch-input {
          width: 60px
        }

        table {
          min-width: 880px
        }
      }

      @media (max-width:600px) {
        header {
          padding: 16px 12px 10px
        }

        h1 {
          font-size: 20px
        }

        .controls {
          gap: 10px
        }

        .btn {
          padding: 12px 14px;
          min-height: 48px;
          /* Extra space on small screens */
        }

        .control {
          min-height: 48px
        }

        .control input[type="text"] {
          min-height: 48px;
          padding: 12px 14px
        }

        th:first-child,
        td:first-child {
          min-width: 140px;
          padding-left: 12px
        }

        .par-row input,
        .hcp-row input,
        .score-input {
          width: 44px;
          padding: 11px 3px;
          min-height: 48px;
          /* Larger on mobile */
        }

        .ch-input {
          width: 56px;
          min-height: 48px
        }

        table {
          min-width: 820px
        }
      }

      /* =========================
   Games launcher / sections
   ========================= */
      .gamesbar {
        margin: 12px 16px 0;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center
      }

      .game-toggle {
        cursor: pointer;
        border: 1px solid var(--line);
        background: #0f151b;
        border-radius: 16px;
        padding: 12px 18px;
        min-height: 48px;
        font-size: 15px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        -webkit-tap-highlight-color: rgba(104, 211, 145, 0.1);
      }

      .game-toggle.active {
        background: #14202a;
        border-color: #224
      }

      .game-section {
        display: none;
        margin: 16px 16px 32px;
        padding: 16px;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: #0f151b
      }

      .game-section.open {
        display: block
      }

      .game-section h2 {
        margin: 0 0 8px;
        font-size: 18px
      }

      .pill {
        font-size: 12px;
        color: var(--muted)
      }

      /* =========================
   Skins (reuses banker table shell)
   ========================= */
      .banker-controls,
      .vegas-controls {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        margin-bottom: 10px;
        background: var(--panel);
      }

      .control-box,
      .team-box,
      .opts-box {
        border: 1px solid var(--line);
        border-radius: 10px;
        padding: 10px;
        background: var(--panel)
      }

      .radio {
        display: inline-flex;
        gap: 6px;
        align-items: center
      }

      .warn {
        color: var(--warn);
        font-size: 12px;
        margin-top: 6px
      }

      /* =========================
   Vegas
   ========================= */
      .vegas-wrap {
        overflow-x: auto;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch;
        touch-action: pan-x pan-y;
        border: 1px solid var(--line);
        border-radius: 10px;
        background: var(--panel);
        scroll-behavior: smooth
      }

      .vegas-table {
        width: max(100%, 720px);
        border-collapse: separate;
        border-spacing: 0
      }

      .vegas-table th,
      .vegas-table td {
        border-bottom: 1px solid var(--line);
        padding: 8px 10px;
        text-align: center;
        white-space: nowrap
      }

      .vegas-table thead th {
        position: sticky;
        top: 0;
        background: #0f151b;
        z-index: 3;
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      .vegas-table thead th:first-child {
        z-index: 4;
        background-color: var(--panel);
      }

      .vegas-table tfoot td {
        background: #0f151b;
        font-weight: 700
      }

      .vegas-table th:first-child,
      .vegas-table td:first-child {
        width: 48px;
        min-width: 48px;
        padding-left: 6px;
        padding-right: 6px;
        position: sticky;
        left: 0;
        background-color: var(--panel);
        z-index: 2;
        border-right: 1px solid var(--line);
        /* iOS sticky fix */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      @media (max-width:600px) {

        .vegas-table th:first-child,
        .vegas-table td:first-child {
          width: 40px;
          min-width: 40px;
          padding-left: 4px;
          padding-right: 4px
        }
      }

      /* =========================
   Banker
   ========================= */
      .banker-wrap {
        overflow-x: auto;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch;
        touch-action: auto !important;
        border: 1px solid var(--line);
        border-radius: 10px;
        background: var(--panel)
      }

      .banker-table {
        width: max(100%, 820px);
        border-collapse: separate;
        border-spacing: 0
      }

      .banker-table th,
      .banker-table td {
        border-bottom: 1px solid var(--line);
        padding: 8px 10px;
        text-align: center;
        white-space: nowrap
      }

      .banker-table thead th {
        position: sticky;
        top: 0;
        background: #0f151b;
        z-index: 3;
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      .banker-table thead th:first-child {
        z-index: 4;
        background-color: var(--panel);
      }

      .banker-table tfoot td {
        background: #0f151b;
        font-weight: 700
      }

      .banker-table th:first-child,
      .banker-table td:first-child {
        width: 48px;
        min-width: 48px;
        padding-left: 6px;
        padding-right: 6px;
        position: sticky;
        left: 0;
        background-color: var(--panel);
        z-index: 2;
        border-right: 1px solid var(--line);
        /* iOS sticky fix */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      @media (max-width:600px) {

        .banker-table th:first-child,
        .banker-table td:first-child {
          width: 40px;
          min-width: 40px;
          padding-left: 4px;
          padding-right: 4px
        }
      }

      /* =========================
   Junk (Dots) ‚Äî table + dropdown
   ========================= */
      #junkTable {
        width: max-content;
        table-layout: fixed
      }

      #junkTable th:first-child,
      #junkTable td:first-child {
        width: 40px;
        min-width: 40px;
        padding-left: 4px;
        padding-right: 4px;
        position: sticky;
        left: 0;
        background-color: var(--panel);
        z-index: 2;
        border-right: 1px solid var(--line);
        /* iOS sticky fix */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      #junkTable th:not(:first-child),
      #junkTable td:not(:first-child) {
        width: 76px
      }

      .junk-dot {
        display: inline-block;
        min-width: 18px;
        text-align: center
      }

      /* Unified junk cell + dropdown */
      .junk-cell {
        display: inline-flex;
        gap: 6px;
        align-items: center;
        justify-content: center
      }

      .junk-dd {
        display: inline-block;
        position: relative
      }

      .junk-dd>summary {
        list-style: none;
        cursor: pointer;
        border: 1px solid var(--line, #333);
        background: #0f151b;
        color: var(--ink, #e6e6e6);
        border-radius: 8px;
        padding: 10px 14px;
        font-size: 14px;
        line-height: 1.2;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        -webkit-tap-highlight-color: rgba(104, 211, 145, 0.1)
      }

      .junk-dd[open]>summary {
        filter: brightness(1.08)
      }

      .junk-dd .menu {
        position: absolute;
        z-index: 10;
        margin-top: 6px;
        display: grid;
        gap: 6px;
        padding: 8px;
        min-width: 160px;
        border: 1px solid var(--line, #333);
        background: #0f151b;
        border-radius: 10px
      }

      .junk-dd .menu label {
        position: relative;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 14px 16px;
        border-radius: 10px;
        cursor: pointer;
        border: 1px solid transparent;
        user-select: none;
        color: var(--ink, #e6e6e6);
        min-height: 44px;
        font-size: 15px
      }

      .junk-dd .menu label input {
        position: absolute;
        inset: 0;
        opacity: 0;
        pointer-events: none
      }

      .junk-dd .menu label:has(input:checked) {
        background: #14202a;
        border-color: #224
      }

      .junk-dd .menu label:has(input:checked)::after {
        content: "‚úì";
        margin-left: auto;
        font-weight: 700
      }

      /* ---- Density tweaks shared by small tables ---- */
      #junkTable tbody td,
      #junkTable tbody th,
      #vegasTable tbody td,
      #vegasTable tbody th {
        padding-top: 6px;
        padding-bottom: 6px
      }

      /* ---- Larger/touch targets ---- */
      .gamesbar .game-toggle {
        min-height: 48px
      }

      input[type="number"],
      input[type="text"] {
        padding: 10px 12px;
        min-height: 44px;
        font-size: 16px;
        /* Prevents iOS zoom on focus */
      }

      /* ---- Responsive tightening ---- */
      @media (max-width:768px) {

        .banker-table th,
        .banker-table td {
          padding: 8px 10px
        }

        #junkTable tbody td,
        #junkTable tbody th,
        #vegasTable tbody td,
        #vegasTable tbody th {
          padding-top: 8px;
          padding-bottom: 8px
        }

        .gamesbar {
          gap: 10px;
          display: flex;
          flex-wrap: wrap;
          margin: 12px 12px 0
        }

        .gamesbar .game-toggle {
          flex: 1 1 auto;
          min-height: 48px
        }

        .game-section {
          margin: 14px 12px 28px;
          padding: 14px
        }

        h2 {
          font-size: 19px;
          margin: 10px 0
        }

        #junkTable th:not(:first-child),
        #junkTable td:not(:first-child) {
          width: 76px
        }

        .junk-dd>summary {
          padding: 10px 12px;
          min-height: 44px
        }
      }

      @media (max-width:420px) {
        .junk-dd>summary {
          min-height: 48px;
          padding: 12px 14px;
          font-size: 15px
        }

        input[type="number"],
        input[type="text"] {
          min-height: 48px;
          padding: 12px 14px;
          font-size: 16px
        }

        .game-toggle {
          padding: 14px 16px;
          font-size: 16px
        }

        .btn,
        .theme-toggle {
          min-height: 48px;
          padding: 14px 18px;
          font-size: 16px
        }
      }

      /* =========================
   Light theme (opt-in)
   ========================= */
      :root[data-theme="light"] {
        --bg: #f4f6f8;
        --panel: #ffffff;
        --panel-2: #f8fafc;
        --ink: #1a1c1f;
        --muted: #5a5f66;
        --accent: #0090e0;
        --line: #d3d7dc;
        --shadow: rgba(0, 0, 0, .08);
      }

      :root[data-theme="light"] body {
        background: var(--bg);
        color: var(--ink)
      }

      /* Panels/wrappers */
      :root[data-theme="light"] .wrap,
      :root[data-theme="light"] .vegas-wrap,
      :root[data-theme="light"] .banker-wrap,
      :root[data-theme="light"] .skins-wrap,
      :root[data-theme="light"] .game-section,
      :root[data-theme="light"] .control,
      :root[data-theme="light"] .control-box,
      :root[data-theme="light"] .team-box,
      :root[data-theme="light"] .opts-box {
        background: var(--panel);
        border-color: var(--line)
      }

      /* Inputs */
      :root[data-theme="light"] input,
      :root[data-theme="light"] select,
      :root[data-theme="light"] textarea {
        background-color: #fff !important;
        color: #1a1c1f !important;
        border: 1px solid #d0d4d9 !important;
        box-shadow: none !important
      }

      :root[data-theme="light"] input:focus,
      :root[data-theme="light"] select:focus,
      :root[data-theme="light"] textarea:focus {
        outline: none;
        border-color: #0090e0 !important;
        box-shadow: 0 0 0 2px rgba(0, 144, 224, .2)
      }

      /* Buttons */
      :root[data-theme="light"] button,
      :root[data-theme="light"] .btn {
        background-color: #f3f5f8 !important;
        color: #1a1c1f !important;
        border: 1px solid #cfd3d8 !important
      }

      :root[data-theme="light"] button:hover,
      :root[data-theme="light"] .btn:hover {
        background-color: #e7eaed !important
      }

      /* Tables */
      :root[data-theme="light"] table {
        background-color: #fff !important;
        color: #1a1c1f !important;
        border-color: #d0d4d9 !important
      }

      :root[data-theme="light"] th {
        background-color: #f1f3f6 !important;
        color: #1a1c1f !important;
        border-color: #d0d4d9 !important
      }

      :root[data-theme="light"] td:first-child {
        background-color: #f7f8fa !important;
        color: #1a1c1f !important
      }

      :root[data-theme="light"] tfoot td {
        background-color: #f1f3f6 !important;
        color: #1a1c1f !important
      }

      :root[data-theme="light"] .par-row th,
      :root[data-theme="light"] .par-row td {
        background: transparent !important;
        border-left: 1px solid rgba(0, 0, 0, 0.15) !important;
        border-top: 1px solid rgba(0, 0, 0, 0.3) !important;
        color: #1a1c1f !important
      }

      :root[data-theme="light"] .hcp-row th,
      :root[data-theme="light"] .hcp-row td {
        background: transparent !important;
        border-left: 1px solid rgba(0, 0, 0, 0.15) !important;
        border-top: 1px solid rgba(0, 0, 0, 0.3) !important;
        border-bottom: 1px solid rgba(0, 0, 0, 0.3) !important;
        color: #1a1c1f !important
      }

      :root[data-theme="light"] .hole-18 {
        border-right: 2px solid rgba(0, 0, 0, 0.4) !important;
      }

      /* =========================
   Light Mode Fix ‚Äî Junk dropdowns & dots
   ========================= */
      :root[data-theme="light"] .junk-dd>summary {
        background-color: #fff !important;
        color: #1a1c1f !important;
        border-color: #d0d4d9 !important;
      }

      :root[data-theme="light"] .junk-dd .menu {
        background-color: #fff !important;
        border-color: #d0d4d9 !important;
      }

      :root[data-theme="light"] .junk-dd .menu label {
        color: #1a1c1f !important;
      }

      :root[data-theme="light"] .junk-dd .menu label:has(input:checked) {
        background-color: #eaf4ff !important;
        border-color: #0090e0 !important;
      }

      /* Optional: lighten junk ‚ÄúDots‚Äù pill buttons */
      :root[data-theme="light"] .junk-cell summary,
      :root[data-theme="light"] .junk-cell button {
        background-color: #f3f5f8 !important;
        color: #1a1c1f !important;
        border-color: #d0d4d9 !important;
      }

      /* Stroke highlighting in light mode */
      :root[data-theme="light"] .score-input.receives-stroke {
        border: 2px solid #dc3545 !important;
        box-shadow: 0 0 0 1px #dc3545 !important;
      }
      
      :root[data-theme="light"] .score-input.receives-stroke[data-strokes="2"] {
        border: 2px solid #dc3545 !important;
        box-shadow: 0 0 0 6px #ffffff, 0 0 0 8px #dc3545 !important;
      }
      
      :root[data-theme="light"] .score-input.receives-stroke[data-strokes="3"] {
        border: 2px solid #dc3545 !important;
        box-shadow: 0 0 0 6px #ffffff, 0 0 0 8px #dc3545, 0 0 0 12px #ffffff, 0 0 0 14px #dc3545 !important;
      }
    </style>
  </head>
  <body>

    <header>
            <h1>Manito Golf Games v.10 PWA</h1>
      <div class="controls">
        <div class="control" style="display: inline-block; margin-right: 12px;">
          <label for="courseSelect" style="margin-right: 4px;">Course:</label>
          <select id="courseSelect" style="padding: 8px; background: var(--panel); color: var(--ink); border: 1px solid var(--line); border-radius: 4px;">
            <!-- Options populated dynamically from COURSES in index.js -->
          </select>
        </div>
        <button id="utilitiesToggle" class="btn accent">‚öôÔ∏è Utilities</button>
        <button id="saveBtn" class="btn accent">üíæ Save</button>
        <button id="refreshAllBtn" class="btn" title="Recalculate all games and totals">üîÑ Recalculate Everything</button>
        <button id="themeToggle" class="theme-toggle" type="button">‚òÄÔ∏è Light Mode</button>
        <span class="meta" id="saveStatus" role="status" aria-live="polite"></span>
      </div>
      <div class="controls" style="margin-top: 16px; display: flex; gap: 12px; align-items: center;">
        <button id="removePlayerBtn" class="btn">‚àí Remove Player</button>
        <button id="addPlayerBtn" class="btn">+ Add Player</button>
        <span id="playerCountDisplay" class="subtle" style="font-size: 14px;"></span>
      </div>
      <div id="utilitiesSection" class="utilities-section">
        <div class="controls">
          <div class="control">
            <label for="csvInput">CSV</label>
            <input id="csvInput" type="file" accept=".csv" />
          </div>
          <button id="dlTemplateBtn" class="btn">Download CSV Template</button>
          <button id="resetBtn" class="btn">Reset Scores</button>
          <button id="clearAllBtn" class="btn">Clear Names & Pars</button>
          <button id="forceRefresh" class="btn" type="button">üîÑ Refresh</button>
        </div>
      </div>
      <p class="small">Swipe the table left/right. Player names stay pinned. Pars & Men's HCP are fixed from the card.</p>
      <p class="small">If a player is a + handicap, enter it as a negative number (e.g., -2).</p>
    </header>
    <header>
    </header>

    <p class="small" id="parBadge" aria-live="polite"></p>
    <!-- SCORECARD -->
    <div class="wrap">
      <table id="scorecard" aria-describedby="saveStatus">
        <thead>
          <tr id="holesHeader">
            <th class="align-left">Player</th>
            <th>CH</th>
            <!-- JS fills Holes 1‚Äì18 + Out + In + Total + To Par + Net -->
          </tr>
        </thead>
        <tbody>
          <tr class="par-row" id="parRow">
            <td class="align-left">
              <strong>Par</strong>
              <span class="subtle">(from card)</span>
            </td>
            <td></td>
          </tr>
          <tr class="hcp-row" id="hcpRow">
            <td class="align-left">
              <strong>HCP Index</strong>
              <span class="subtle">(from card)</span>
            </td>
            <td></td>
          </tr>
          <!-- Player rows inserted by JS -->
        </tbody>
        <tfoot>
          <tr id="totalsRow">
            <td class="align-left">Totals</td>
            <td></td>
            <!-- JS adds per-hole sums + Out/In/Total; placeholders align To Par / Net -->
          </tr>
        </tfoot>
      </table>
    </div>
    <!-- GAMES LAUNCHER -->
    <div class="gamesbar">
      <button id="toggleJunk" class="game-toggle">üóëÔ∏è Junk</button>
      <button id="toggleSkins" class="game-toggle">üíé Skins</button>
      <button id="toggleVegas" class="game-toggle">üé≤ Vegas</button>
      <button id="toggleBanker" class="game-toggle">üè¶ Banker</button>
      <button id="toggleBankerVegas" class="game-toggle">üè¶üé≤ Banker-Vegas</button>
    </div>
    <!-- SKINS GAME -->
    <section class="game-section" id="skinsSection" aria-hidden="true">
      <h2>Skins</h2>
      <div class="banker-controls">
        <div class="control-box">
          <div class="pill">Options</div>
          <label class="radio">
            <input type="checkbox" id="skinsCarry" checked /> Carry over on ties </label>
          <br />
          <label class="radio">
            <input type="checkbox" id="skinsHalf" /> Half pops </label>
          <br />
          <label class="input-label">
            Buy-in per player: $<input type="number" id="skinsBuyIn" min="0" step="0.01" value="10" inputmode="decimal" autocomplete="off"
              style="width: 80px; display: inline-block; margin-left: 4px; -moz-appearance: textfield; appearance: textfield;" />
          </label>
        </div>
        <div class="control-box">
          <div class="pill">Legend</div>
          <div class="small">Net = Gross ‚àí strokes (play off low CH). NDB cap applies.</div>
          <div class="small">Pot = Buy-in √ó Active Players. Dollar winnings = (Skins won / Total skins) √ó Pot.</div>
        </div>
      </div>
      <div class="banker-wrap">
        <table class="banker-table" id="skinsTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Holes Skinned</th>
              <th>Total</th>
              <th>Winnings</th>
            </tr>
          </thead>
          <tbody id="skinsBody"></tbody>
        </table>
      </div>
      <p class="small" id="skinsSummary">
        <!-- Player hole summaries will render here -->
      </p>
    </section>
    <!-- VEGAS GAME -->
    <section class="game-section" id="vegasSection" aria-hidden="true">
      <h2>Vegas Game</h2>
      <div class="vegas-controls">
        <div class="team-box">
          <div class="team-pill">Assign teams (exactly two per team)</div>
          <div class="team-grid" id="vegasTeams"></div>
          <div class="warn" id="vegasTeamWarning" hidden>Pick exactly two players on Team A and two on Team B.</div>
        </div>
        <div class="opts-box">
          <div class="team-pill">Options</div>
          <label class="radio">
            <input type="checkbox" id="optUseNet" /> Use Net (NDB) </label>
          <br />
          <label class="radio">
            <input type="checkbox" id="optDoubleBirdie" checked /> Double on Birdie (winner) </label>
          <br />
          <label class="radio">
            <input type="checkbox" id="optTripleEagle" checked /> Triple on Eagle (winner) </label>
          <br />
          <label class="radio" title="Dollar value per Vegas point">
            $/point
            <input type="number" id="vegasPointValue" min="0" step="0.25" value="1" inputmode="decimal" autocomplete="off" class="ch-input" style="width:96px; margin-left:8px" />
          </label>
        </div>
      </div>
      <div class="vegas-wrap">
        <table class="vegas-table" id="vegasTable">
          <thead>
            <tr>
              <th>Hole</th>
              <th>Team A</th>
              <th>Team B</th>
              <th>Mult</th>
              <th>Pts (A)</th>
              <th>Pts (B)</th>
            </tr>
          </thead>
          <tbody id="vegasBody"></tbody>
          <tfoot>
            <tr>
              <td>
                <strong>Totals</strong>
              </td>
              <td id="vegasTotalA">‚Äî</td>
              <td id="vegasTotalB">‚Äî</td>
              <td></td>
              <td id="vegasPtsA">‚Äî</td>
              <td id="vegasPtsB">‚Äî</td>
            </tr>
            <tr>
              <td>
                <strong>Dollars</strong>
              </td>
              <td id="vegasDollarA">‚Äî</td>
              <td id="vegasDollarB">‚Äî</td>
              <td></td>
              <td></td>
            </tr>
            <tr id="vegasGameBreakdown" style="display:none;">
              <td>
                <strong>Games</strong>
              </td>
              <td colspan="5" id="vegasGameBreakdownData" style="font-size: 0.9em; padding: 8px;">‚Äî</td>
            </tr>
          </tfoot>
        </table>
      </div>
      <p class="small">Vegas number puts the lower individual score first by default (e.g., 4 &amp; 5 ‚Üí <strong>45</strong>). If a team makes a birdie+, the other team‚Äôs digits flip (hi‚Äìlo) for that hole. Points = (higher ‚àí lower) √ó multiplier; winner gets the points. </p>
    </section>
    <!-- BANKER GAME (stubbed: empty window) -->
    <section class="game-section" id="bankerSection" aria-hidden="true">
      <h2>Banker - To Be Added</h2>
    </section>
    <!-- BANKER-VEGAS GAME (placeholder) -->
    <section class="game-section" id="bankerVegasSection" aria-hidden="true">
      <h2>Banker-Vegas - To Be Added</h2>
    </section>
    <p class="note"> Net Double Bogey per hole: cap = Par + 2 + strokes received on that hole. Players ‚Äúplay off‚Äù the lowest CH (e.g., +2 / 2 / 4 ‚Üí adjusted 0 / 4 / 6). </p>
    <script src="index.js" defer></script>
    <!-- Inline bootstrap to verify scripts run and to wire a minimal listener as fallback -->
    <script>
      console.log('[golfGames] inline bootstrap script loaded');
      (function(){
        var btn = document.getElementById('printBtn');
        if(btn){
          btn.addEventListener('click', function(){
            console.log('[golfGames] inline listener fired');
          }, { once: false });
        }
      })();
      
      // Highlight holes where players receive strokes
      window.addEventListener('DOMContentLoaded', function() {
        
        function updateStrokeHighlights() {
          // Use global HCPMEN (updated when course changes)
          const HCPMEN = window.HCPMEN || [7,13,11,15,17,1,5,9,3, 10,2,12,14,18,4,6,16,8];
          setTimeout(function() {
            const playerRows = document.querySelectorAll('.player-row');
            if(!playerRows.length) return;
            
            // Get all CHs
            const chs = [];
            playerRows.forEach(function(row) {
              const chInput = row.querySelector('.ch-input');
              const val = chInput && chInput.value !== '' ? parseFloat(chInput.value) : null;
              chs.push(val !== null && !isNaN(val) ? val : null);
            });
            
            // Calculate adjusted CHs (play off low) - only consider players with entered CHs
            const validCHs = chs.filter(function(ch) { return ch !== null; });
            if(validCHs.length === 0) return;
            
            const minCH = Math.min.apply(null, validCHs);
            const adjustedCHs = chs.map(function(ch) { return ch !== null ? ch - minCH : 0; });
            
            // Update each player's score inputs
            playerRows.forEach(function(row, playerIdx) {
              const adjustedCH = adjustedCHs[playerIdx];
              const scoreInputs = row.querySelectorAll('.score-input');
              
              // Only highlight if this player has a CH entered
              if(chs[playerIdx] === null) {
                scoreInputs.forEach(function(input) {
                  input.classList.remove('receives-stroke');
                  input.removeAttribute('title');
                });
                return;
              }
              
              scoreInputs.forEach(function(input, holeIdx) {
                const holeHCP = HCPMEN[holeIdx];
                // Correct formula: player gets stroke if their adjusted CH >= hole's HCP index
                const fullStrokes = Math.floor(adjustedCH / 18);
                const remainingStrokes = adjustedCH % 18;
                const getsStroke = remainingStrokes >= holeHCP;
                const totalStrokes = fullStrokes + (getsStroke ? 1 : 0);
                
                if(totalStrokes > 0) {
                  input.classList.add('receives-stroke');
                  input.setAttribute('data-strokes', totalStrokes);
                  input.setAttribute('title', 'Receives ' + totalStrokes + ' stroke(s)');
                } else {
                  input.classList.remove('receives-stroke');
                  input.removeAttribute('data-strokes');
                  input.removeAttribute('title');
                }
              });
            });
          }, 100);
        }
        
        // Update on CH input changes and score input changes
        document.addEventListener('input', function(e) {
          if(e.target && e.target.classList && (e.target.classList.contains('ch-input') || e.target.classList.contains('score-input'))) {
            updateStrokeHighlights();
          }
        });
        
        // Also update on load event from main script
        setTimeout(updateStrokeHighlights, 500);
        setTimeout(updateStrokeHighlights, 1000);
        
        // Make globally accessible for course switching
        window.updateStrokeHighlights = updateStrokeHighlights;
        
        // Initial update
        updateStrokeHighlights();
      });
    </script>
    <!-- JUNK GAME -->
    <section class="game-section" id="junkSection" aria-hidden="true">
      <h2>Junk (Dots)</h2>
      <div class="banker-wrap">
        <table class="banker-table" id="junkTable">
          <thead>
            <tr>
              <th>Hole</th>
              <th id="junkP1">P1</th>
              <th id="junkP2">P2</th>
              <th id="junkP3">P3</th>
              <th id="junkP4">P4</th>
            </tr>
          </thead>
          <tbody id="junkBody"></tbody>
          <tfoot>
            <tr>
              <td>
                <strong>Totals</strong>
              </td>
              <td id="junkTotP1">‚Äî</td>
              <td id="junkTotP2">‚Äî</td>
              <td id="junkTotP3">‚Äî</td>
              <td id="junkTotP4">‚Äî</td>
            </tr>
            <tr>
              <td>
                <strong>Net Totals</strong>
              </td>
              <td id="junkNetP1">‚Äî</td>
              <td id="junkNetP2">‚Äî</td>
              <td id="junkNetP3">‚Äî</td>
              <td id="junkNetP4">‚Äî</td>
            </tr>
          </tfoot>
        </table>
      </div>
      <p class="small">Dots per hole: Eagle = 4, Birdie = 2, Par = 1, otherwise 0. Computed from the scorecard.</p>
    </section>
    
    <!-- PWA Service Worker Registration -->
    <script>
      // FORCE HARD RELOAD on every PWA open (mimics tap refresh)
      window.addEventListener('pageshow', (event) => {
        // If page was restored from cache (iOS back-forward cache), force reload
        if (event.persisted) {
          console.log('[PWA] Page from cache, forcing hard reload...');
          window.location.reload();
        }
      });
      
      // Force hard reload on first load if not already done
      if (!sessionStorage.getItem('pwa_reloaded')) {
        console.log('[PWA] First load, forcing hard reload...');
        sessionStorage.setItem('pwa_reloaded', 'true');
        window.location.reload(true); // Hard reload
      }
      
      if ('serviceWorker' in navigator) {
        let refreshing = false;
        
        // Listen for messages from service worker
        navigator.serviceWorker.addEventListener('message', (event) => {
          if (event.data && event.data.type === 'RELOAD') {
            if (!refreshing) {
              refreshing = true;
              console.log('[PWA] Service worker requested reload');
              window.location.reload();
            }
          }
        });
        
        // AGGRESSIVE: Unregister all service workers first, then re-register fresh
        navigator.serviceWorker.getRegistrations().then((registrations) => {
          console.log('[PWA] Found', registrations.length, 'existing registrations');
          return Promise.all(registrations.map(r => r.unregister()));
        }).then(() => {
          console.log('[PWA] All old registrations cleared');
          // Now register fresh
          return navigator.serviceWorker.register('/sw.js', { 
            updateViaCache: 'none' // Don't cache the service worker file itself
          });
        }).then((registration) => {
          console.log('[PWA] Service Worker registered fresh');
          
          // Force immediate update check
          registration.update();
          
          // Check for updates when page becomes visible (iOS app switching)
          document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
              console.log('[PWA] Page visible, checking for updates...');
              registration.update();
            }
          });
          
          // Check for updates every 10 seconds while app is open (aggressive for testing)
          setInterval(() => {
            registration.update();
          }, 10000);
          
          // Check when page gains focus (iOS specific)
          window.addEventListener('focus', () => {
            console.log('[PWA] Window focused, checking for updates...');
            registration.update();
          });
        }).catch((error) => {
          console.log('[PWA] Service Worker registration failed:', error);
        });
        
        // Auto-reload when new version takes control
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!refreshing) {
            refreshing = true;
            console.log('[PWA] New controller detected, reloading...');
            window.location.reload();
          }
        });
      }
    </script>
  </body>
</html>